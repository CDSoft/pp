% PP test file (markdown)
% Christophe Delord

Introduction
============

This document is a test file for `pp`.
It is preprocessed and compared with `pp-test.ref`.

The document also computes the test results.

Macros definition
=================

## Definition

----------------------------------- -----------------------------------------------------------------
Definition of `mac1`                
Show macro definition:              This is macro `mac1`
Show macro value:                   This is macro `mac1`
----------------------------------- -----------------------------------------------------------------

## Undefinition

----------------------------------- -----------------------------------------------------------------
Undefined macro `mac2`              
Show macro definition:              
Show macro value:                   !mac2
----------------------------------- -----------------------------------------------------------------

## Definition with arguments

----------------------------------- -----------------------------------------------------------------
Definition with arguments:          
Show macro definition:              !2 !1
Show macro value:                   !mac2 This is macro `mac1`
----------------------------------- -----------------------------------------------------------------

## Passing arguments between user macros (see issue #29)

----------------------------------- -----------------------------------------------------------------
A calls B calls C:                  C got 42
same with 3 args:                   C got 44 42 43
----------------------------------- -----------------------------------------------------------------

----------------------------------- -----------------------------------------------------------------
Undefinition:                       
----------------------------------- -----------------------------------------------------------------

----------------------------------- -----------------------------------------------------------------
Definition test:                    
Definition test:                    swap is defined
Definition test:                    mac1 is not defined
Definition test:                    swap is defined
Undefinition test:                  mac1 is not defined
Undefinition test:                  
Undefinition test:                  mac1 is not defined
Undefinition test:                  swap is defined
----------------------------------- -------------------------------------------------------------

## Testing argument scopes (see issue #33)



----------------------------------- -------------------------------------------------------------
Before calling f:                    
call with 2 args:                   f take 2 args: one and two but not !3
between two calls:                   
call with 1 arg:                    f take 2 args: one' and  but not !3
between two calls:                   
call with 2 args:                   f take 2 args: one'' and two'' but not !3
after calling f:                     
----------------------------------- -------------------------------------------------------------


----------------------------------- -------------------------------------------------------------
Before calling g:                    
call with 2 args:                   f take 2 args: one and two but not !3
between two calls:                   
call with 1 arg:                    f take 2 args: one' and  but not !3
between two calls:                   
call with 2 args:                   f take 2 args: one'' and two'' but not !3
after calling g:                     
----------------------------------- -------------------------------------------------------------


----------------------------------- -------------------------------------------------------------
Before calling g:                    
call with 2 args:                   f take 2 args: one and -two- but not !3
between two calls:                   
call with 1 arg:                    f take 2 args: one' and -- but not !3
between two calls:                   
call with 2 args:                   f take 2 args: one'' and -two''- but not !3
after calling g:                     
----------------------------------- -------------------------------------------------------------

## Equality / Inequality

  

----------------------------------- -----------------------------------------------------------------
Equality test:                      one == un
Equality test:                      
Equality test:                      one == un
Equality test:                      one /= two
Inequality test:                    
Inequality test:                    one /= two
Inequality test:                    one == un
Inequality test:                    one /= two
----------------------------------- -----------------------------------------------------------------

----------------------------------- -----------------------------------------------------------------
Raw text:                           !swap(a)(b)
Evaluated:                          b a
----------------------------------- -----------------------------------------------------------------

File inclusion
==============

## Before including `pp-test.i`

----------------------------------- -----------------------------------------------------------------
File name of the main file:         test/pp-test.md
File name of the current file:      test/pp-test.md
----------------------------------- -----------------------------------------------------------------

## Inclusion of `pp-test.i`

First line of the included file.

----------------------------------- -----------------------------------------------------------------
File name of the main file:         test/pp-test.md
File name of the included file:     test/pp-test.i
Definitions:                        answer = 42
----------------------------------- -----------------------------------------------------------------

Last line of the included file.


## After including `pp-test.i`

----------------------------------- -----------------------------------------------------------------
Definitions:                        42
----------------------------------- -----------------------------------------------------------------

## Files included without preprocessing

----------------------------------- -----------------------------------------------------------------
Undefinition:                       
----------------------------------- -----------------------------------------------------------------

First line of the included file.

----------------------------------- -----------------------------------------------------------------
File name of the main file:         !main
File name of the included file:     !file
Definitions:                        !def(answer)(42)answer = !answer
----------------------------------- -----------------------------------------------------------------

Last line of the included file.


----------------------------------- -----------------------------------------------------------------
No definitions:                     !answer
----------------------------------- -----------------------------------------------------------------

## Files imported

In the document:



Before importing: answer = !answer

After import: answer = 42

And from the command line:

imported_macro: The imported macro works!

Comments and quiet definitions
==============================

## Comments





## Quiet definitions



----------------------------------- -----------------------------------------------------------------
Definitions:                        3.14
----------------------------------- -----------------------------------------------------------------

File modification date
======================



----------------------------------- -----------------------------------------------------------------
Current file date:                  mdate = date of test/pp-test.md
Specific file date:                 Wednesday 23 June 2010
----------------------------------- -----------------------------------------------------------------

Environment variables
=====================

----------------------------------- -----------------------------------------------------------------
Undefined environment variable:     
Environment variable:               42
----------------------------------- -----------------------------------------------------------------

OS architecture
===============

----------------------------------- -----------------------------------------------------------------
OS:                                 linux
Architecture:                       x86_64
----------------------------------- -----------------------------------------------------------------

Simple arithmetic
=================

----------------------------------- -----------------------------------------------------------------
undefined + 1 =                     1
1 + 1 =                             2
undefined + 3 =                     3
3 + 4 =                             7
----------------------------------- -----------------------------------------------------------------

Dialect, Output language and output format
==========================================

## Dialect

----------------------------------- -----------------------------------------------------------------
The current dialect is md:          md
All dialects:                       md rst
Section for a markdown document:    Hello World!
Section for a rst document:         
----------------------------------- -----------------------------------------------------------------

## Language

----------------------------------- -----------------------------------------------------------------
The current language is "en":       en
All languages:                      en es fr it
Section in english:                 Hello World!
Section in french:                  
----------------------------------- -----------------------------------------------------------------

## Format

----------------------------------- -----------------------------------------------------------------
The current format is HTML:         html
All formats:                        epub html mobi odf pdf
Section for an HTML document:       Hello World!
Section for a PDF document:         
----------------------------------- -----------------------------------------------------------------

External commands and scripts execution
=======================================



----------------------------------- ------------------------------------------------------------------------------
Command line (uses sh):             exec(echo "hi é")
`sh` script:                        hi é
`bash` script:                      hi à
`bat` script:                       hi ç
`cmd` script:                       hi ç
`python` script:                    hi
`python2` script:                   hi
`python3` script:                   hi
`haskell` script:                   hi
`exec` script:                      !def(x)(42)!x
`rawexec` script:                   !def(x)(42)!x
Raw script output:                  !mymacro(42)
Preprocessed script output:         mymacro(42) has been evaluated!
----------------------------------- ------------------------------------------------------------------------------

And a Haskell Stack script:

hi


Diagrams
========

The diagram test does not check the generated images, just the links in the output document.

![Test of dot](img/dot-test.png)
![Test of neato](img/neato-test.png)
![Test of twopi](img/twopi-test.png)
![Test of circo](img/circo-test.png)
![Test of fdp](img/fdp-test.png)
![Test of patchwork](img/patchwork-test.png)
![Test of osage](img/osage-test.png)

![Test of uml](img/uml-test.png)

![Test of ditaa](img/ditaa-test.png)

![](img/size_small.png){.img width=50}

![Small with title](img/size_smallt.png){.img width=50}

![](img/size_normal.png){.img width=100}

![Normal with title](img/size_normalt.png){.img width=100}

![](img/size_big.png){.img width=150}

![Big with title](img/size_bigt.png){.img width=150}

Literate programming
====================

Lets write and test a useful library:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ {.c}
// This is a C library
@functionDeclarations

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ {.c}
// This is a C library
@functionImplementations

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


The `fib` function computes Fibonacci's numbers:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ {.C}
int fib(int n);

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ {.C}
int fib(int n)
{
    return (n < 2) ? 1 : fib(n-1) + fib(n-2);
}

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


The `fact` function computes factorial numbers:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ {.C}
int fact(int n);
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ {.C}
int fact(int n)
{
    return (n <= 1) ? 1 : n * fact(n-1);
}

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


Some tests of `mylib.c`:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ {.C}
#include <stdio.h>
#include <stdlib.h>

#include "mylib.h"

int main(int argc, char * argv[])
{
    int i;
    for (i = 1; i < argc; i++)
    {
        int n = atoi(argv[i]);
        printf("fact(%d) = %3d; fib(%d) = %3d\n", n, fact(n), n, fib(n));
    }
    return 0;
}

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~







`mylibtest 0 1 2 3 4 5` outputs:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
fact(0) =   1; fib(0) =   1
fact(1) =   1; fib(1) =   1
fact(2) =   2; fib(2) =   2
fact(3) =   6; fib(3) =   3
fact(4) =  24; fib(4) =   5
fact(5) = 120; fib(5) =   8
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

The complete source files are:

`mylib.h`:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ {.c}
// This is a C library
@functionDeclarations

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


`mylib.c`:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ {.c}
// This is a C library
@functionImplementations

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


`mylibtest.c`:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ {.C}
#include <stdio.h>
#include <stdlib.h>

#include "mylib.h"

int main(int argc, char * argv[])
{
    int i;
    for (i = 1; i < argc; i++)
    {
        int n = atoi(argv[i]);
        printf("fact(%d) = %3d; fib(%d) = %3d\n", n, fact(n), n, fib(n));
    }
    return 0;
}

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


A source file, not necessarily generated with !lit can be
formated with !source or !src:

`mylib.h`:

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~ {.c}
// This is a C library
int fib(int n);
int fact(int n);

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


And with a different codeblock separator:

15 '~':

~~~~~~~~~~~~~~~ {.c}
// This is a C library
int fib(int n);
int fact(int n);

~~~~~~~~~~~~~~~


20 '`':

```````````````````` {.c}
// This is a C library
int fib(int n);
int fact(int n);

````````````````````


25 '~' (default character):

~~~~~~~~~~~~~~~~~~~~~~~~~ {.c}
// This is a C library
int fib(int n);
int fact(int n);

~~~~~~~~~~~~~~~~~~~~~~~~~


CSV tables
==========

This file with a header:

~~~~~~~~~~~~~~~~~~~~~~~~~
Year,Make,Model,Description,Price
1997,Ford,E350,"ac, abs, moon",3000.00
1999,Chevy,"Venture ""Extended Edition""","",4900.00
1999,Chevy,"Venture ""Extended Edition, Very Large""",,5000.00
1996,Jeep,Grand Cherokee,"MUST SELL!
air, moon roof, loaded",4799.00

~~~~~~~~~~~~~~~~~~~~~~~~~



is rendered by `!csv(file.csv)` as:

+------+-------+----------------------------------------+-----------------------------------+---------+
| Year | Make  | Model                                  | Description                       |   Price |
+=====:+:======+:=======================================+:==================================+========:+
| 1997 | Ford  | E350                                   | ac, abs, moon                     | 3000.00 |
+------+-------+----------------------------------------+-----------------------------------+---------+
| 1999 | Chevy | Venture "Extended Edition"             |                                   | 4900.00 |
+------+-------+----------------------------------------+-----------------------------------+---------+
| 1999 | Chevy | Venture "Extended Edition, Very Large" |                                   | 5000.00 |
+------+-------+----------------------------------------+-----------------------------------+---------+
| 1996 | Jeep  | Grand Cherokee                         | MUST SELL! air, moon roof, loaded | 4799.00 |
+------+-------+----------------------------------------+-----------------------------------+---------+


This file without any header:

~~~~~~~~~~~~~~~~~~~~~~~~~
1997,Ford,E350,"ac, abs, moon",3000.00
1999,Chevy,"Venture ""Extended Edition""","",4900.00
1999,Chevy,"Venture ""Extended Edition, Very Large""",,5000.00
1996,Jeep,Grand Cherokee,"MUST SELL!
air, moon roof, loaded",4799.00

~~~~~~~~~~~~~~~~~~~~~~~~~



is rendered by `!csv(file.csv)(Year|Make|Model|Description|Price)` as:

+------+-------+----------------------------------------+-----------------------------------+---------+
| Year | Make  | Model                                  | Description                       |   Price |
+=====:+:======+:=======================================+:==================================+========:+
| 1997 | Ford  | E350                                   | ac, abs, moon                     | 3000.00 |
+------+-------+----------------------------------------+-----------------------------------+---------+
| 1999 | Chevy | Venture "Extended Edition"             |                                   | 4900.00 |
+------+-------+----------------------------------------+-----------------------------------+---------+
| 1999 | Chevy | Venture "Extended Edition, Very Large" |                                   | 5000.00 |
+------+-------+----------------------------------------+-----------------------------------+---------+
| 1996 | Jeep  | Grand Cherokee                         | MUST SELL! air, moon roof, loaded | 4799.00 |
+------+-------+----------------------------------------+-----------------------------------+---------+


Parser customization
====================



Set new macro chars: `+=` 

Active  : `+` => foo has been called
Active  : `=` => foo has been called
Inactive: `\` => \foo
Inactive: `!` => !foo

Restore the default behaviour: `!\` 

Inactive: `+` => +foo
Inactive: `=` => =foo
Active  : `\` => foo has been called
Active  : `!` => foo has been called

Set new literate macro chars: `$` 

~~~~~~~~~~~~~~~~~~~~~~~~~
$foo - $foo
~~~~~~~~~~~~~~~~~~~~~~~~~

~~~~~~~~~~~~~~~~~~~~~~~~~
I'm foo
~~~~~~~~~~~~~~~~~~~~~~~~~


Result: 

```
I'm foo - I'm foo
```

Restore the default behaviour: `@` 
